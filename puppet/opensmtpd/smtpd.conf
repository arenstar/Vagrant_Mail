# (create key with 'openssl rand -hex 16')
queue compression
queue encryption key 11a693e7d0bfcc20548a4f008a78b8ed

max-message-size 50M

pki arenstar.net certificate "/etc/pki/wildcard_arenstar.net.pem"
pki arenstar.net key "/etc/pki/wildcard_arenstar.net.key"

# === Tables === #

table aliases file:/etc/aliases
table domains file:/etc/maildomains
#table blacklist-recipients file:/etc/blacklist-recipients

# === Listen === #

# Listen on smtp and smtps
listen on 0.0.0.0 port 25 tls auth-optional pki arenstar.net hostname arenstar.net
# On smtps tls is required. Any non-TLS connection will be dropped. Only authenticated users can use this port
listen on 0.0.0.0 port 587 tls-require auth pki arenstar.net hostname arenstar.net mask-source

# I use amavisd as an smtp relay, so mails must be relayed to it for filtering
# Mails incoming from amavisd with spamassassin headers. Tag them as filtered
listen on lo port 10026 tag Filtered
# Outgoing DKIM signed emails from amavisd. These must go out.
listen on lo port 10028 tag Signed

# === Handle Messages === #


# Job is done. Pass filtered stuff to dovecot.
# You shouldn't write mails directly to maildir because sieve script would not run in that case.
# You can either write it to dovecot's lmtp or calling dovecot-mda
accept tagged Filtered for any alias <aliases> deliver to lmtp "127.0.0.1:2525"

# Accept mail for domains and relay it to amavisd to filter
# amavisd listens to port 10024 on localhost
accept from any for domain <domains> relay via "smtp://127.0.0.1:10025"

# Relay signed messages
# from local is an implied default
accept tagged Signed for any relay
# All local mails go to amavis to get signed
accept for any relay via "smtp://127.0.0.1:10027"
